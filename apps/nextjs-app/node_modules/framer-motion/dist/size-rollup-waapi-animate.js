const t=t=>t;let e=t;function i(t){let e;return()=>(void 0===e&&(e=t()),e)}const n=(t,e,i)=>{const n=e-t;return 0===n?1:(i-t)/n},a=t=>1e3*t,s=t=>t/1e3,o=i(()=>void 0!==window.ScrollTimeline);class r extends class{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,e){for(let i=0;i<this.animations.length;i++)this.animations[i][t]=e}attachTimeline(t,e){const i=this.animations.map(i=>o()&&i.attachTimeline?i.attachTimeline(t):"function"==typeof e?e(i):void 0);return()=>{i.forEach((t,e)=>{t&&t(),this.animations[e].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let e=0;e<this.animations.length;e++)t=Math.max(t,this.animations[e].duration);return t}runAll(t){this.animations.forEach(e=>e[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}{then(t,e){return Promise.all(this.animations).then(t).catch(e)}}const l={linearEasing:void 0};function u(t,e){const n=i(t);return()=>{var t;return null!==(t=l[e])&&void 0!==t?t:n()}}const h=u(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch(t){return!1}return!0},"linearEasing"),m=([t,e,i,n])=>`cubic-bezier(${t}, ${e}, ${i}, ${n})`,c={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:m([0,.65,.55,1]),circOut:m([.55,0,1,.45]),backIn:m([.31,.01,.66,-.59]),backOut:m([.33,1.53,.69,.99])};function d(t,e){return t?"function"==typeof t&&h()?((t,e,i=10)=>{let a="";const s=Math.max(Math.round(e/i),2);for(let e=0;e<s;e++)a+=t(n(0,s-1,e))+", ";return`linear(${a.substring(0,a.length-2)})`})(t,e):(t=>Array.isArray(t)&&"number"==typeof t[0])(t)?m(t):Array.isArray(t)?t.map(t=>d(t,e)||c.easeOut):c[t]:void 0}const p=(t=>({test:e=>"string"==typeof e&&e.endsWith(t)&&1===e.split(" ").length,parse:parseFloat,transform:e=>`${e}${t}`}))("px"),f={borderWidth:p,borderTopWidth:p,borderRightWidth:p,borderBottomWidth:p,borderLeftWidth:p,borderRadius:p,radius:p,borderTopLeftRadius:p,borderTopRightRadius:p,borderBottomRightRadius:p,borderBottomLeftRadius:p,width:p,maxWidth:p,height:p,maxHeight:p,top:p,right:p,bottom:p,left:p,padding:p,paddingTop:p,paddingRight:p,paddingBottom:p,paddingLeft:p,margin:p,marginTop:p,marginRight:p,marginBottom:p,marginLeft:p,backgroundPositionX:p,backgroundPositionY:p},y=t=>null!==t;function g(t,e,i){t.style.setProperty(e,i)}function v(t,e,i){t.style[e]=i}const A=i(()=>{try{document.createElement("div").animate({opacity:[1]})}catch(t){return!1}return!0}),b=i(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),T=new WeakMap;function P(t){const e=T.get(t)||new Map;return T.set(t,e),T.get(t)}class w extends class{constructor(t){this.animation=t}get duration(){var t,e,i;const n=(null===(e=null===(t=this.animation)||void 0===t?void 0:t.effect)||void 0===e?void 0:e.getComputedTiming().duration)||(null===(i=this.options)||void 0===i?void 0:i.duration)||300;return s(Number(n))}get time(){var t;return this.animation?s((null===(t=this.animation)||void 0===t?void 0:t.currentTime)||0):0}set time(t){this.animation&&(this.animation.currentTime=a(t))}get speed(){return this.animation?this.animation.playbackRate:1}set speed(t){this.animation&&(this.animation.playbackRate=t)}get state(){return this.animation?this.animation.playState:"finished"}get startTime(){return this.animation?this.animation.startTime:null}get finished(){return this.animation?this.animation.finished:Promise.resolve()}play(){this.animation&&this.animation.play()}pause(){this.animation&&this.animation.pause()}stop(){this.animation&&"idle"!==this.state&&"finished"!==this.state&&(this.animation.commitStyles&&this.animation.commitStyles(),this.cancel())}flatten(){var t,e;this.animation&&(null===(t=this.options)||void 0===t?void 0:t.allowFlatten)&&(null===(e=this.animation.effect)||void 0===e||e.updateTiming({easing:"linear"}))}attachTimeline(e){return this.animation&&function(t,e){t.timeline=e,t.onfinish=null}(this.animation,e),t}complete(){this.animation&&this.animation.finish()}cancel(){try{this.animation&&this.animation.cancel()}catch(t){}}}{constructor(t,i,n,o){const r=i.startsWith("--");e("string"!=typeof o.type);const l=P(t).get(i);l&&l.stop();if(Array.isArray(n)||(n=[n]),function(t,e,i){for(let n=0;n<e.length;n++)null===e[n]&&(e[n]=0===n?i():e[n-1]),"number"==typeof e[n]&&f[t]&&(e[n]=f[t].transform(e[n]));!A()&&e.length<2&&e.unshift(i())}(i,n,()=>i.startsWith("--")?t.style.getPropertyValue(i):window.getComputedStyle(t)[i]),"function"==typeof o.type){const t=function(t,e=100,i){const n=i({...t,keyframes:[0,e]}),a=Math.min(function(t){let e=0,i=t.next(e);for(;!i.done&&e<2e4;)e+=50,i=t.next(e);return e>=2e4?1/0:e}(n),2e4);return{type:"keyframes",ease:t=>n.next(a*t).value/e,duration:s(a)}}(o,100,o.type);o.ease=h()?t.ease:"easeOut",o.duration=a(t.duration),o.type="keyframes"}else o.ease=o.ease||"easeOut";const u=()=>{this.setValue(t,i,function(t,{repeat:e,repeatType:i="loop"},n){const a=t.filter(y),s=e&&"loop"!==i&&e%2==1?0:a.length-1;return s&&void 0!==n?n:a[s]}(n,o)),this.cancel(),this.resolveFinishedPromise()},m=()=>{this.setValue=r?g:v,this.options=o,this.updateFinishedPromise(),this.removeAnimation=()=>{const e=T.get(t);e&&e.delete(i)}};b()?(super(function(t,e,i,{delay:n=0,duration:a=300,repeat:s=0,repeatType:o="loop",ease:r="easeInOut",times:l}={}){const u={[e]:i};l&&(u.offset=l);const h=d(r,a);return Array.isArray(h)&&(u.easing=h),t.animate(u,{delay:n,duration:a,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:"reverse"===o?"alternate":"normal"})}(t,i,n,o)),m(),!1===o.autoplay&&this.animation.pause(),this.animation.onfinish=u,P(t).set(i,this)):(super(),m(),u())}then(t,e){return this.currentFinishedPromise.then(t,e)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}play(){"finished"===this.state&&this.updateFinishedPromise(),super.play()}cancel(){this.removeAnimation(),super.cancel()}}function R(t,e,i,n){const s=function(t,e,i){var n;if(t instanceof EventTarget)return[t];if("string"==typeof t){let a=document;e&&(a=e.current);const s=null!==(n=null==i?void 0:i[t])&&void 0!==n?n:a.querySelectorAll(t);return s?Array.from(s):[]}return Array.from(t)}(t,n),o=s.length,r=[];for(let t=0;t<o;t++){const n=s[t],h={...i};"function"==typeof h.delay&&(h.delay=h.delay(t,o));for(const t in e){const i=e[t],s={...(l=h,u=t,l?l[u]||l.default||l:void 0)};s.duration=s.duration?a(s.duration):s.duration,s.delay=a(s.delay||0),s.allowFlatten=!h.type&&!h.ease,r.push(new w(n,t,i,s))}}var l,u;return r}const x=t=>function(e,i,n){return new r(R(e,i,n,t))},k=x();export{k as animateMini,x as createScopedWaapiAnimate};
